<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This Rust library implements a wrapper type called `SendWrapper` which allows you to move around non-`Send` types between threads, as long as you access the contained value only from within the original thread. You also have to make sure that the wrapper is dropped from within the original thread. If any of these constraints is violated, a panic occurs."><meta name="keywords" content="rust, rustlang, rust-lang, parity_send_wrapper"><title>parity_send_wrapper - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../parity_send_wrapper/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate parity_send_wrapper</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.1.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all parity_send_wrapper's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li></ul></div><div id="sidebar-vars" data-name="parity_send_wrapper" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">parity_send_wrapper</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/parity_send_wrapper/lib.rs.html#9-267" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This <a href="https://www.rust-lang.org">Rust</a> library implements a wrapper type called <code>SendWrapper</code> which allows you to move around non-<a href="https://doc.rust-lang.org/std/marker/trait.Send.html"><code>Send</code></a> types
between threads, as long as you access the contained value only from within the original thread. You also have to
make sure that the wrapper is dropped from within the original thread. If any of these constraints is violated,
a panic occurs.</p>
<p>The idea for this library was born in the context of a <a href="https://www.gtk.org/"><code>GTK+</code></a>/<a href="http://gtk-rs.org/"><code>gtk-rs</code></a>-based application. <a href="https://www.gtk.org/"><code>GTK+</code></a> applications
are strictly single-threaded. It is not allowed to call any <a href="https://www.gtk.org/"><code>GTK+</code></a> method from a thread different to the main
thread. Consequently, all <a href="http://gtk-rs.org/"><code>gtk-rs</code></a> structs are non-<a href="https://doc.rust-lang.org/std/marker/trait.Send.html"><code>Send</code></a>.</p>
<p>Sometimes you still want to do some work in background. It is possible to enqueue <a href="https://www.gtk.org/"><code>GTK+</code></a> calls from there to be
executed in the main thread <a href="http://gtk-rs.org/docs/glib/source/fn.idle_add.html">using <code>Glib</code></a>. This way you can know, that the <a href="http://gtk-rs.org/"><code>gtk-rs</code></a> structs involved are only
accessed in the main thread and will also be dropped there. This library makes it possible that <a href="http://gtk-rs.org/"><code>gtk-rs</code></a> structs
can leave the main thread at all, like required in the given</p>
<h2 id="examples" class="section-header"><a href="#examples">Examples</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">send_wrapper::SendWrapper</span>;
<span class="kw">use</span> <span class="ident">std::rc::Rc</span>;
<span class="kw">use</span> <span class="ident">std::thread</span>;
<span class="kw">use</span> <span class="ident">std::sync::mpsc::channel</span>;

<span class="comment">// This import is important. It allows you to unwrap the value using deref(),</span>
<span class="comment">// deref_mut() or Deref coercion.</span>
<span class="kw">use</span> <span class="ident">std::ops</span>::{<span class="ident">Deref</span>, <span class="ident">DerefMut</span>};

<span class="comment">// Rc is a non-Send type.</span>
<span class="kw">let</span> <span class="ident">value</span> <span class="op">=</span> <span class="ident">Rc::new</span>(<span class="number">42</span>);

<span class="comment">// We now wrap the value with `SendWrapper` (value is moved inside).</span>
<span class="kw">let</span> <span class="ident">wrapped_value</span> <span class="op">=</span> <span class="ident">SendWrapper::new</span>(<span class="ident">value</span>);

<span class="comment">// A channel allows us to move the wrapped value between threads.</span>
<span class="kw">let</span> (<span class="ident">sender</span>, <span class="ident">receiver</span>) <span class="op">=</span> <span class="ident">channel</span>();

<span class="kw">let</span> <span class="ident">t</span> <span class="op">=</span> <span class="ident">thread::spawn</span>(<span class="kw">move</span> <span class="op">|</span><span class="op">|</span> {

<span class="comment">// This would panic (because of dereferencing in wrong thread):</span>
<span class="comment">// let value = wrapped_value.deref();</span>

	<span class="comment">// Move SendWrapper back to main thread, so it can be dropped from there.</span>
	<span class="comment">// If you leave this out the thread will panic because of dropping from wrong thread.</span>
	<span class="ident">sender</span>.<span class="ident">send</span>(<span class="ident">wrapped_value</span>).<span class="ident">unwrap</span>();

});

<span class="kw">let</span> <span class="ident">wrapped_value</span> <span class="op">=</span> <span class="ident">receiver</span>.<span class="ident">recv</span>().<span class="ident">unwrap</span>();

<span class="comment">// Now you can use the value again.</span>
<span class="kw">let</span> <span class="ident">value</span> <span class="op">=</span> <span class="ident">wrapped_value</span>.<span class="ident">deref</span>();

<span class="comment">// alternatives for dereferencing:</span>
<span class="comment">// let value = *wrapped_value;</span>
<span class="comment">// let value: &amp;NonSendType = &amp;wrapped_value;</span>

<span class="comment">// alternatives for mutable dereferencing (value and wrapped_value must be mutable too, then):</span>
<span class="comment">// let mut value = wrapped_value.deref_mut();</span>
<span class="comment">// let mut value = &amp;mut *wrapped_value;</span>
<span class="comment">// let mut value: &amp;mut NonSendType = &amp;mut wrapped_value;</span></code></pre></div>
<h2 id="license" class="section-header"><a href="#license">License</a></h2>
<p><code>send_wrapper</code> is distributed under the terms of both the MIT license and the Apache License (Version 2.0).</p>
<p>See LICENSE-APACHE.txt, and LICENSE-MIT.txt for details.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SendWrapper.html" title="parity_send_wrapper::SendWrapper struct">SendWrapper</a></div><div class="item-right docblock-short"><p>A wrapper which allows you to move around non-<a href="https://doc.rust-lang.org/1.57.0/core/marker/trait.Send.html" title="Send"><code>Send</code></a>-types between threads, as long as you access the contained
value only from within the original thread and make sure that it is dropped from within the original thread.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="parity_send_wrapper" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>